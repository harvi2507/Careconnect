<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CareConnect | Nurse Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
:root{
  --blue-main:#0a73ff;
  --blue-soft:#eaf4ff;
  --text-dark:#2b2b2b;
  --white:#ffffff;
}

*{
  box-sizing:border-box;
  font-family:'Poppins',sans-serif;
}

body{
  margin:0;
  background:#eaf4ff;
}

/* ===== TOP HEADER ===== */
.header{
  background:var(--white);
  padding:18px 30px;
  display:flex;
  align-items:center;
  box-shadow:0 8px 20px rgba(74,144,226,0.15);
}

.logo{
  display:flex;
  align-items:center;
}

.logo-icon{
  width:42px;
  height:42px;
  background:var(--blue-main);
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-right:12px;
}

.logo-icon i{
  color:white;
  font-size:20px;
}

.logo-text{
  font-size:22px;
  font-weight:600;
  color:var(--text-dark);
}

/* ===== PAGE ===== */
.container{
  max-width:900px;
  margin:auto;
  padding:40px 20px;
}

.card{
  background:white;
  border-radius:26px;
  padding:30px;
  box-shadow:0 25px 60px rgba(0,0,0,.08);
}

/* renamed to avoid conflict */
.card-header{
  display:flex;
  gap:20px;
  align-items:center;
}

.avatar{
  width:110px;
  height:110px;
  background:#eaf2ff;
  border-radius:26px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:42px;
}

.tags span{
  background:#eef2ff;
  padding:6px 14px;
  border-radius:20px;
  font-size:13px;
  margin-right:6px;
}

.section{
  margin-top:24px;
}

button{
  margin-top:30px;
  width:100%;
  padding:16px;
  border:none;
  border-radius:18px;
  background:#0a73ff;
  color:white;
  font-weight:600;
  font-size:16px;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- TOP HEADER -->
<div class="header">
  <div class="logo">
    <div class="logo-icon">
      <i class="fa-solid fa-heart"></i>
    </div>
    <div class="logo-text">CareConnect</div>
  </div>
</div>

<div class="container">
  <div class="card">

    <div class="card-header">
      <div class="avatar">üë©‚Äç‚öïÔ∏è</div>
      <div>
        <h2 id="name">Loading...</h2>
<div class="tags">
  <span id="specialization"></span>
  <span id="availability"></span>
  <span id="experience"></span>
</div>
<p><strong id="price"></strong></p>

      </div>
    </div>

    <div class="section">
      <h3>Professional Summary</h3>
      <p id="summary"></p>

    </div>

    <div class="section">
      <h3>Details</h3>
     <p><strong>Location:</strong> <span id="city"></span></p>
<p><strong>Languages:</strong> <span id="languages"></span></p>
<p><strong>Availability:</strong> <span id="availability2"></span></p>

    </div>

    <button id="requestBtn">
  Request Care
</button>


  </div>
</div>

<script type="module">
  import {
  collection,
  addDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

import {
  getAuth,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  
import { db } from "./firebase.js";
import {
  doc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// 1Ô∏è‚É£ Get UID from URL
const params = new URLSearchParams(window.location.search);
const uid = params.get("uid");

if (!uid) {
  alert("Invalid nurse profile");
  throw new Error("UID missing");
}

// 2Ô∏è‚É£ Fetch nurse data
async function loadNurseProfile() {
  const ref = doc(db, "users", uid);
  const snap = await getDoc(ref);

  if (!snap.exists()) {
    alert("Nurse not found");
    return;
  }

  const n = snap.data();

  // 3Ô∏è‚É£ Inject data into page
  document.getElementById("name").textContent = n.fullName || "Nurse";
  document.getElementById("specialization").textContent = n.specialization || "General Care";
  document.getElementById("availability").textContent = n.availability || "Available";
  document.getElementById("availability2").textContent = n.availability || "Available";
  document.getElementById("experience").textContent = `${n.experience || 0}+ Years`;
  document.getElementById("price").textContent = `‚Çπ${n.cost || "N/A"} / day`;
  document.getElementById("city").textContent = n.city || "India";
  document.getElementById("languages").textContent = n.languages || "English";
  document.getElementById("summary").textContent =
    n.summary || "Professional home care nurse.";
}

loadNurseProfile();
const auth = getAuth();
const requestBtn = document.getElementById("requestBtn");

let currentUser = null;

// Check login
onAuthStateChanged(auth, user => {
  if (!user) {
    alert("Please login first");
    window.location.href = "login.html";
    return;
  }
  currentUser = user;
});

// Send care request
requestBtn.addEventListener("click", async () => {
  if (!currentUser) return;

  try {
    await addDoc(collection(db, "careRequests"), {
      nurseId: uid,              // nurse profile you are viewing
      userId: currentUser.uid,   // logged-in user
      status: "pending",
      createdAt: serverTimestamp()
    });

    alert("Care request sent successfully!");
    window.location.href = "post-care-request.html";
  } catch (error) {
    console.error(error);
    alert("Failed to send request");
  }
});

</script>

</body>
</html>